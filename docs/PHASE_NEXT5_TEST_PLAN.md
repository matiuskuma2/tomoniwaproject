# Phase Next-5 テストプラン

## 目的

Phase Next-5（自動調整機能）の全機能を体系的にテストし、事故ゼロを保証する。

---

## テスト範囲

### **Day1: 自動候補生成（メールのみ）**
- ✅ 実装済み
- ✅ デプロイ済み

### **Day2: 確認フロー（はい/いいえ）**
- ✅ 実装済み
- ✅ デプロイ済み

### **Day2.1: 技術的負債ゼロ化**
- ✅ 実装済み
- ✅ デプロイ済み

### **Day3: 追加候補提案（提案のみ）**
- ✅ 実装済み
- ✅ デプロイ済み
- ⚠️ **テスト未実施**

---

## テストケース一覧

### **Day1: 自動候補生成**

#### **TC-D1-01: 基本フロー（メール1件）**

**前提条件:**
- ログイン済み

**手順:**
1. 「tanaka@example.com に来週30分で候補出して」と入力
2. 送信

**期待結果:**
- ✅ 5件の候補が表示される
- ✅ 「📧 送信先: tanaka@example.com」と表示
- ✅ 「⚠️ まだスレッドを作成していません」と表示
- ✅ 「はい」「いいえ」の指示が表示
- ✅ POST なし

---

#### **TC-D1-02: メール複数件**

**手順:**
1. 「tanaka@example.com, sato@example.com に候補出して」と入力

**期待結果:**
- ✅ 5件の候補が表示される
- ✅ 「📧 送信先: tanaka@example.com, sato@example.com」と表示

---

#### **TC-D1-03: メールなし**

**手順:**
1. 「候補出して」と入力（メールなし）

**期待結果:**
- ✅ needsClarification が返る
- ✅ 「送る相手のメールアドレスを貼ってください」と表示
- ✅ POST なし

---

#### **TC-D1-04: 所要時間指定**

**手順:**
1. 「tanaka@example.com に来週60分で候補出して」と入力

**期待結果:**
- ✅ 5件の候補が表示される（60分間隔）
- ✅ duration: 60 が設定される

---

### **Day2: 確認フロー**

#### **TC-D2-01: 基本フロー（はい → POST）**

**前提条件:**
- Day1 の候補が表示済み
- `pendingAutoPropose` が存在

**手順:**
1. 「はい」と入力
2. 送信

**期待結果:**
- ✅ `POST /api/threads` が実行される
- ✅ スレッドが作成される
- ✅ 招待リンクが表示される
- ✅ `pendingAutoPropose` がクリアされる

---

#### **TC-D2-02: キャンセル（いいえ）**

**前提条件:**
- Day1 の候補が表示済み
- `pendingAutoPropose` が存在

**手順:**
1. 「いいえ」と入力
2. 送信

**期待結果:**
- ✅ POST なし
- ✅ 「✅ 候補をキャンセルしました」と表示
- ✅ `pendingAutoPropose` がクリアされる

---

#### **TC-D2-03: pending なしで「はい」（誤爆防止）**

**前提条件:**
- ブラウザをリロード（`pendingAutoPropose` がクリア）

**手順:**
1. 「はい」と入力
2. 送信

**期待結果:**
- ✅ POST なし
- ✅ 「❌ 候補が選択されていません」と表示
- ✅ 「先に「〇〇に候補出して」と入力してください」と表示

---

### **Day3: 追加候補提案**

#### **TC-D3-01: 基本フロー（未返信あり）**

**前提条件:**
- スレッド選択済み
- 未返信 >= 1

**手順:**
1. 「追加候補出して」と入力
2. 送信

**期待結果:**
- ✅ `GET /api/threads/:id/status` が実行される
- ✅ `analyzeStatusForPropose()` で true が返る
- ✅ 3件の追加候補が表示される
- ✅ 「📌 注意: この候補はまだスレッドに追加されていません」と表示
- ✅ 「はい」「いいえ」の指示が表示
- ✅ POST なし

---

#### **TC-D3-02: 票割れケース（1位と2位が同票）**

**前提条件:**
- スレッド選択済み
- スロット A: 2票
- スロット B: 2票
- スロット C: 1票

**手順:**
1. 「追加候補出して」と入力
2. 送信

**期待結果:**
- ✅ `analyzeStatusForPropose()` で true が返る
- ✅ 3件の追加候補が表示される

---

#### **TC-D3-03: 票割れケース（最大票が1）**

**前提条件:**
- スレッド選択済み
- スロット A: 1票
- スロット B: 0票
- スロット C: 0票

**手順:**
1. 「追加候補出して」と入力
2. 送信

**期待結果:**
- ✅ `analyzeStatusForPropose()` で true が返る
- ✅ 3件の追加候補が表示される

---

#### **TC-D3-04: 追加不要ケース（未返信なし・票安定）**

**前提条件:**
- スレッド選択済み
- 未返信 = 0
- スロット A: 5票
- スロット B: 2票
- スロット C: 1票

**手順:**
1. 「追加候補出して」と入力
2. 送信

**期待結果:**
- ✅ `analyzeStatusForPropose()` で false が返る
- ✅ 「現在の状況では追加候補は不要です」と表示
- ✅ POST なし

---

#### **TC-D3-05: スレッド未選択**

**前提条件:**
- スレッド未選択

**手順:**
1. 「追加候補出して」と入力
2. 送信

**期待結果:**
- ✅ needsClarification が返る
- ✅ 「どのスレッドに追加候補を提案しますか？」と表示
- ✅ POST なし

---

#### **TC-D3-06: 追加候補 → 確認（はい）**

**前提条件:**
- Day3 の追加候補が表示済み
- `pendingAutoPropose` が存在

**手順:**
1. 「はい」と入力
2. 送信

**期待結果:**
- ✅ `POST /api/threads` が実行される（Day2 の confirm フロー）
- ✅ スレッドが作成される
- ✅ 招待リンクが表示される
- ✅ `pendingAutoPropose` がクリアされる

---

### **統合テスト**

#### **TC-INT-01: End-to-End フロー（Day1 → Day2）**

**手順:**
1. 「tanaka@example.com に来週30分で候補出して」と入力
2. 5件の候補が表示される
3. 「はい」と入力
4. スレッドが作成される
5. 招待リンクが表示される

**期待結果:**
- ✅ 全フロー成功
- ✅ POST は1回のみ

---

#### **TC-INT-02: End-to-End フロー（Day3 → Day2）**

**前提条件:**
- スレッド選択済み（未返信あり）

**手順:**
1. 「追加候補出して」と入力
2. 3件の追加候補が表示される
3. 「はい」と入力
4. スレッドが作成される（Day2 confirm フロー）

**期待結果:**
- ✅ 全フロー成功
- ✅ POST は1回のみ

---

#### **TC-INT-03: キャンセル後の再試行**

**手順:**
1. 「tanaka@example.com に候補出して」と入力
2. 5件の候補が表示される
3. 「いいえ」と入力（キャンセル）
4. 「tanaka@example.com に候補出して」と入力（再試行）
5. 5件の候補が表示される
6. 「はい」と入力
7. スレッドが作成される

**期待結果:**
- ✅ キャンセル成功
- ✅ 再試行成功
- ✅ POST は最後の1回のみ

---

## テスト実施チェックリスト

### **Day1: 自動候補生成**
- [ ] TC-D1-01: 基本フロー（メール1件）
- [ ] TC-D1-02: メール複数件
- [ ] TC-D1-03: メールなし
- [ ] TC-D1-04: 所要時間指定

### **Day2: 確認フロー**
- [ ] TC-D2-01: 基本フロー（はい → POST）
- [ ] TC-D2-02: キャンセル（いいえ）
- [ ] TC-D2-03: pending なしで「はい」（誤爆防止）

### **Day3: 追加候補提案**
- [ ] TC-D3-01: 基本フロー（未返信あり）
- [ ] TC-D3-02: 票割れケース（1位と2位が同票）
- [ ] TC-D3-03: 票割れケース（最大票が1）
- [ ] TC-D3-04: 追加不要ケース
- [ ] TC-D3-05: スレッド未選択
- [ ] TC-D3-06: 追加候補 → 確認（はい）

### **統合テスト**
- [ ] TC-INT-01: End-to-End フロー（Day1 → Day2）
- [ ] TC-INT-02: End-to-End フロー（Day3 → Day2）
- [ ] TC-INT-03: キャンセル後の再試行

---

## テスト環境

### **Production**
- URL: https://app.tomoniwao.jp
- 最新デプロイ: https://d0a50e2d.webapp-6t3.pages.dev

### **ブラウザ**
- Chrome (推奨)
- Safari (モバイル)
- Edge

### **テストデータ**
- テストメール: `tanaka@example.com`, `sato@example.com`
- テストスレッド: 実際のスレッドを使用

---

## テスト実施ログ

### **実施日:** (未実施)

### **実施者:** (未定)

### **結果:**
- 成功: 0件
- 失敗: 0件
- スキップ: 0件

---

## 不具合報告フォーマット

### **不具合ID:** BUG-XXXX

**発生日時:**

**テストケース:** TC-XXX

**現象:**
- 何が起きたか

**期待結果:**
- 何が期待されていたか

**再現手順:**
1. 
2. 
3. 

**スクリーンショット:**
- (貼り付け)

**ログ:**
- Console ログ
- Network ログ

---

## 次のアクション

1. **テスト実施**
   - [ ] Day1 のテストケースを実施
   - [ ] Day2 のテストケースを実施
   - [ ] Day3 のテストケースを実施
   - [ ] 統合テストを実施

2. **不具合修正**
   - [ ] 不具合がある場合は修正
   - [ ] 再テスト

3. **リリース判定**
   - [ ] 全テストケースが成功したらリリース承認
   - [ ] README 更新

---

**モギモギさん、テストプランを作成しました！**

次のアクション:
- テストを実施するか
- Next-6/Next-7 へ進むか

お願いします！ 🚀
