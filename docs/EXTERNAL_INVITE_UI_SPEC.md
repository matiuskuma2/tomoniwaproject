# /i/:token UI仕様書（TimeRex/Spear型）

## 目的
**外部招待者が迷わず候補を選べる体験**
- スマホで快適に操作できる
- エラー状態を明確に伝える
- 視覚フィードバックが豊富

---

## 画面状態フロー

```
┌─────────────────┐
│ Token検証       │
└────┬────────────┘
     │
     ├─ 無効token → 404エラー画面
     ├─ 期限切れ → 期限切れ画面
     ├─ 既回答済 → 既回答画面
     └─ 正常     → 候補選択画面
                    ↓
              ┌─────────────┐
              │ 候補選択画面  │
              └──┬──────┬───┘
                 │      │
             Accept  Decline
                 │      │
                 ↓      ↓
          ┌──────────┐ ┌──────────┐
          │ 完了画面  │ │ 辞退画面  │
          └──────────┘ └──────────┘
```

---

## 画面別仕様

### 1. **候補選択画面（正常状態）**

#### 表示要素
- **ヘッダー**: 「日程調整のご案内」
- **タイトル**: Thread title
- **説明**: Thread description（あれば）
- **招待理由**: "なぜあなたが選ばれたか"
- **候補日時リスト**: ラジオボタン形式
  - 日本語表記：「2025年12月28日（土）14:00-15:00」
  - タイムゾーン表示
  - 選択中の候補はハイライト
- **アクションボタン**:
  - 「この日程で参加する」（緑色、プライマリ）
  - 「辞退する」（グレー、セカンダリ）
- **有効期限**: 「この招待は〇〇まで有効です」

#### 視覚フィードバック
- 候補にホバー時：境界線が青に
- 候補選択時：背景が青に、チェックマークアイコン
- ボタンクリック時：ローディングスピナー
- 送信中：ボタン無効化

#### レスポンシブ
- デスクトップ: 最大幅600px、中央配置
- モバイル: 画面幅いっぱい、余白4px

---

### 2. **完了画面（Accept成功）**

#### 表示要素
- **アイコン**: 緑色の✓（大きく）
- **ヘッダー**: 「日程を選択しました」
- **メッセージ**: 
  ```
  選択した日程：2025年12月28日（土）14:00-15:00
  
  主催者が確定すると、メールで通知が届きます。
  しばらくお待ちください。
  ```
- **補足**: 「このページは閉じて構いません」

#### スタイル
- 中央配置、max-width: 500px
- 緑色のアクセント
- アニメーション: フェードイン

---

### 3. **辞退画面（Decline成功）**

#### 表示要素
- **アイコン**: グレーの✗
- **ヘッダー**: 「参加を辞退しました」
- **メッセージ**: 
  ```
  ご都合が合わなかったようで残念です。
  主催者には自動で通知されます。
  
  またの機会にご参加ください。
  ```

#### 確認ダイアログ
- 「辞退する」ボタンクリック時:
  ```
  本当に辞退しますか？
  
  [キャンセル] [辞退する]
  ```

---

### 4. **エラー画面**

#### 4-1. 無効なトークン（404）
```
⚠️ この招待リンクは無効です

このリンクは削除されたか、正しくありません。
招待元にお問い合わせください。
```

#### 4-2. 期限切れ
```
⌛ この招待は期限切れです

有効期限: 2025年12月25日 23:59

新しい招待リンクが必要な場合は、
主催者にお問い合わせください。
```

#### 4-3. 既回答済み
```
✓ すでに回答済みです

あなたの回答: 参加（2025年12月28日 14:00-15:00を選択）

変更が必要な場合は、主催者にお問い合わせください。
```

#### 4-4. ネットワークエラー
```
❌ 送信に失敗しました

インターネット接続を確認して、
もう一度お試しください。

[再試行]
```

---

## 文言ガイドライン

### 基本方針
- **丁寧だが堅苦しくない**
- **スマホで読みやすい短文**
- **次のアクションが明確**

### 用語統一
| × ダメな例 | ○ 良い例 |
|------------|---------|
| スロットを選択 | 日程を選択 |
| 受諾/承認 | 参加する |
| 拒否/却下 | 辞退する |
| エラーが発生しました | 送信に失敗しました |
| 処理中... | 送信中... |

---

## カラーパレット

### メインカラー
- **プライマリ（青）**: `#3B82F6` (Tailwind blue-500)
- **成功（緑）**: `#10B981` (Tailwind green-500)
- **警告（黄）**: `#F59E0B` (Tailwind amber-500)
- **エラー（赤）**: `#EF4444` (Tailwind red-500)

### 背景
- **メイン背景**: `#F3F4F6` (Tailwind gray-100)
- **カード背景**: `#FFFFFF`
- **選択中背景**: `#DBEAFE` (Tailwind blue-100)

### テキスト
- **プライマリ**: `#1F2937` (Tailwind gray-800)
- **セカンダリ**: `#6B7280` (Tailwind gray-500)
- **無効**: `#9CA3AF` (Tailwind gray-400)

---

## アニメーション

### フェードイン
```css
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
.fade-in {
  animation: fadeIn 0.3s ease-out;
}
```

### ローディングスピナー
```html
<svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
</svg>
```

---

## モバイル対応

### ビューポート設定
```html
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
```

### タッチターゲット
- 最小サイズ: 44x44px（iOS標準）
- ボタン間の余白: 最低8px

### フォントサイズ
- ヘッダー: 24px (1.5rem)
- 本文: 16px (1rem)
- 小文字: 14px (0.875rem)

---

## 実装チェックリスト

### 必須要件
- [ ] start_at/end_at カラム名修正
- [ ] 日本語日時表示（toLocaleDateString）
- [ ] ラジオボタンの視覚フィードバック
- [ ] ボタンのローディング状態
- [ ] エラーメッセージのUI改善（alert廃止）
- [ ] 期限切れの詳細表示
- [ ] 既回答時の回答内容表示

### 推奨要件
- [ ] フェードインアニメーション
- [ ] ローディングスピナー
- [ ] モバイル最適化
- [ ] ダークモード対応（将来）

---

## テスト観点

### 機能テスト
1. 正常な候補選択
2. 辞退の確認ダイアログ
3. 無効トークンのエラー表示
4. 期限切れの判定
5. 既回答の状態確認

### UI/UXテスト
1. スマホ（iOS Safari / Android Chrome）
2. タブレット（iPad）
3. デスクトップ（Chrome / Firefox / Safari）
4. 画面回転時の表示
5. ダブルタップ防止

### パフォーマンス
1. 初期表示: 1秒以内
2. ボタン反応: 100ms以内
3. 通信エラー時のリトライ

---

## 参考URL

- **TimeRex**: https://timerex.net/s/[token]
- **Spear**: https://spir.com/e/[event_id]
- **Calendly**: https://calendly.com/[username]

---

## 次のステップ

1. invite.ts の実装修正
2. ローカルE2E（スマホシミュレータ）
3. 本番デプロイ
4. 実機テスト（iOS/Android）
