# Tomoniwao - ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãƒãƒƒãƒ—

**æœ€çµ‚æ›´æ–°**: 2026-01-17  
**ã‚³ãƒŸãƒƒãƒˆ**: P1-4 contactsCache è¿½åŠ 

---

## ğŸ“Š ãƒ•ã‚¡ã‚¤ãƒ«çµ±è¨ˆ

| ã‚«ãƒ†ã‚´ãƒª | ãƒ•ã‚¡ã‚¤ãƒ«æ•° | ç·è¡Œæ•° |
|---------|----------|--------|
| Backend Routes | 27 | ~250,000 |
| Frontend Core | 25+ | ~100,000 |
| Migrations | 62 | ~15,000 |
| Docs | 120+ | ~50,000 |

---

## ğŸ—‚ï¸ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
tomoniwaproject/
â”œâ”€â”€ apps/
â”‚   â””â”€â”€ api/                          # Backend (Cloudflare Workers)
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ index.ts              # ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ
â”‚       â”‚   â”œâ”€â”€ routes/               # APIãƒ«ãƒ¼ãƒˆ (27ãƒ•ã‚¡ã‚¤ãƒ«)
â”‚       â”‚   â”œâ”€â”€ services/             # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”‚       â”‚   â”œâ”€â”€ repositories/         # ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹
â”‚       â”‚   â”œâ”€â”€ middleware/           # èªè¨¼ãƒ»CORSç­‰
â”‚       â”‚   â””â”€â”€ utils/                # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚       â”œâ”€â”€ wrangler.toml             # Cloudflareè¨­å®š
â”‚       â””â”€â”€ package.json
â”‚
â”œâ”€â”€ frontend/                         # Frontend (Cloudflare Pages)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ core/                     # ã‚³ã‚¢ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”‚   â”œâ”€â”€ api/                  # APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ (8ãƒ•ã‚¡ã‚¤ãƒ«)
â”‚   â”‚   â”‚   â”œâ”€â”€ cache/                # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ (8ãƒ•ã‚¡ã‚¤ãƒ«) â˜…P1-3/P1-4
â”‚   â”‚   â”‚   â”œâ”€â”€ chat/                 # ãƒãƒ£ãƒƒãƒˆå‡¦ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ classifier/       # Intentåˆ†é¡
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ executors/        # Executor (5ãƒ•ã‚¡ã‚¤ãƒ«) â˜…P1-1
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ apiExecutor.ts    # ãƒ¡ã‚¤ãƒ³Executor
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ intentClassifier.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ hooks/                # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ (1ãƒ•ã‚¡ã‚¤ãƒ«)
â”‚   â”‚   â”‚   â”œâ”€â”€ refresh/              # ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ (3ãƒ•ã‚¡ã‚¤ãƒ«) â˜…P0-2
â”‚   â”‚   â”‚   â””â”€â”€ platform/             # ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ æŠ½è±¡åŒ–
â”‚   â”‚   â”œâ”€â”€ components/               # UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ pages/                    # ãƒšãƒ¼ã‚¸
â”‚   â”‚   â””â”€â”€ utils/                    # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ db/
â”‚   â””â”€â”€ migrations/                   # D1ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ (62ãƒ•ã‚¡ã‚¤ãƒ«)
â”‚       â”œâ”€â”€ 0001_init_core.sql
â”‚       â”œâ”€â”€ ...
â”‚       â””â”€â”€ 0073_backfill_thread_timezone.sql
â”‚
â”œâ”€â”€ docs/                             # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ (120+ãƒ•ã‚¡ã‚¤ãƒ«)
â”‚   â”œâ”€â”€ PROJECT_STATE_2026_01.md      # å®Œå…¨çŠ¶æ…‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ â˜…NEW
â”‚   â”œâ”€â”€ DISASTER_RECOVERY.md          # å¾©æ—§æ‰‹é † â˜…NEW
â”‚   â”œâ”€â”€ SOURCE_CODE_MAP.md            # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ« â˜…NEW
â”‚   â”œâ”€â”€ DATABASE_SCHEMA.md            # DBè¨­è¨ˆ
â”‚   â”œâ”€â”€ MIGRATION_HISTORY.md          # ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å±¥æ­´
â”‚   â””â”€â”€ API_REFERENCE.md              # APIä»•æ§˜
â”‚
â””â”€â”€ package.json                      # ãƒ«ãƒ¼ãƒˆpackage.json
```

---

## ğŸ”— ä¾å­˜é–¢ä¿‚ãƒãƒƒãƒ—

### Frontend ã‚³ã‚¢ä¾å­˜é–¢ä¿‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        UI Components                             â”‚
â”‚  (pages/*, components/*)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ import
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Custom Hooks                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ useViewerTimezone.ts                                      â”‚  â”‚
â”‚  â”‚   â””â”€â”€ imports: getCachedMe, getMe, subscribeMe            â”‚  â”‚
â”‚  â”‚   â””â”€â”€ imports: getBrowserTimeZone (utils/datetime)        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ import
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Cache Layer                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ index.ts (exports all)                                      â”‚ â”‚
â”‚  â”‚   â”œâ”€â”€ meCache.ts         â†’ usersMeApi                       â”‚ â”‚
â”‚  â”‚   â”œâ”€â”€ listsCache.ts      â†’ listsApi                         â”‚ â”‚
â”‚  â”‚   â”œâ”€â”€ contactsCache.ts   â†’ contactsApi â˜…P1-4                â”‚ â”‚
â”‚  â”‚   â”œâ”€â”€ threadStatusCache.ts â†’ threadsApi                     â”‚ â”‚
â”‚  â”‚   â”œâ”€â”€ threadsListCache.ts  â†’ threadsApi                     â”‚ â”‚
â”‚  â”‚   â”œâ”€â”€ inboxCache.ts      â†’ inboxApi                         â”‚ â”‚
â”‚  â”‚   â””â”€â”€ useThreadStatus.ts â†’ threadStatusCache                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ import
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       API Layer                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ index.ts (exports all)                                      â”‚ â”‚
â”‚  â”‚   â”œâ”€â”€ client.ts          â†’ fetch wrapper                    â”‚ â”‚
â”‚  â”‚   â”œâ”€â”€ usersMe.ts         â†’ /api/users/me                    â”‚ â”‚
â”‚  â”‚   â”œâ”€â”€ lists.ts           â†’ /api/lists                       â”‚ â”‚
â”‚  â”‚   â”œâ”€â”€ threads.ts         â†’ /api/threads                     â”‚ â”‚
â”‚  â”‚   â”œâ”€â”€ contacts.ts        â†’ /api/contacts                    â”‚ â”‚
â”‚  â”‚   â”œâ”€â”€ inbox.ts           â†’ /api/inbox                       â”‚ â”‚
â”‚  â”‚   â”œâ”€â”€ calendar.ts        â†’ /api/calendar                    â”‚ â”‚
â”‚  â”‚   â”œâ”€â”€ pendingActions.ts  â†’ /api/pending-actions             â”‚ â”‚
â”‚  â”‚   â””â”€â”€ voice.ts           â†’ /api/voice                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Chat Executor ä¾å­˜é–¢ä¿‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     apiExecutor.ts (main)                        â”‚
â”‚                         63,950 lines                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ imports
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      executors/                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ index.ts                                                    â”‚ â”‚
â”‚  â”‚   â”œâ”€â”€ list.ts (8,367 lines)                                 â”‚ â”‚
â”‚  â”‚   â”‚     â””â”€â”€ executeListCreate, executeListList,             â”‚ â”‚
â”‚  â”‚   â”‚         executeListMembers, executeListAddMember        â”‚ â”‚
â”‚  â”‚   â”‚     â””â”€â”€ imports: listsApi, contactsApi                  â”‚ â”‚
â”‚  â”‚   â”‚     â””â”€â”€ imports: refreshLists, refreshContacts â˜…P1-4    â”‚ â”‚
â”‚  â”‚   â”‚                                                         â”‚ â”‚
â”‚  â”‚   â”œâ”€â”€ thread.ts (14,935 lines)                              â”‚ â”‚
â”‚  â”‚   â”‚     â””â”€â”€ executeCreate, executeStatusCheck,              â”‚ â”‚
â”‚  â”‚   â”‚         executeFinalize, executeThreadCreate,           â”‚ â”‚
â”‚  â”‚   â”‚         executeInviteList                               â”‚ â”‚
â”‚  â”‚   â”‚                                                         â”‚ â”‚
â”‚  â”‚   â”œâ”€â”€ calendar.ts (5,858 lines)                             â”‚ â”‚
â”‚  â”‚   â”‚     â””â”€â”€ executeToday, executeWeek, executeFreeBusy      â”‚ â”‚
â”‚  â”‚   â”‚                                                         â”‚ â”‚
â”‚  â”‚   â””â”€â”€ types.ts (5,662 lines)                                â”‚ â”‚
â”‚  â”‚         â””â”€â”€ ExecutionResult, ExecutionContext               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Refresh Layer ä¾å­˜é–¢ä¿‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Executors                                   â”‚
â”‚  (executors/list.ts, executors/thread.ts, etc.)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ calls runRefresh() or direct refresh
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     runRefresh.ts                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ runRefresh(actions: RefreshAction[])                        â”‚ â”‚
â”‚  â”‚   â”œâ”€â”€ case 'STATUS':  â†’ refreshStatus(threadId)             â”‚ â”‚
â”‚  â”‚   â”œâ”€â”€ case 'THREADS_LIST': â†’ refreshThreadsListCache()      â”‚ â”‚
â”‚  â”‚   â”œâ”€â”€ case 'INBOX':   â†’ refreshInboxCache()                 â”‚ â”‚
â”‚  â”‚   â”œâ”€â”€ case 'ME':      â†’ refreshMeCache() â˜…P1-3              â”‚ â”‚
â”‚  â”‚   â”œâ”€â”€ case 'LISTS':   â†’ refreshListsCache() â˜…P1-3           â”‚ â”‚
â”‚  â”‚   â””â”€â”€ case 'CONTACTS': â†’ refreshContactsCache() â˜…P1-4       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ uses mapping from
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     refreshMap.ts                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ WriteOp â†’ RefreshAction[]                                   â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚ THREAD_CREATE       â†’ [STATUS, THREADS_LIST]                â”‚ â”‚
â”‚  â”‚ INVITE_SEND         â†’ [STATUS, INBOX]                       â”‚ â”‚
â”‚  â”‚ ADD_SLOTS           â†’ [STATUS]                              â”‚ â”‚
â”‚  â”‚ REMIND_PENDING      â†’ [STATUS, INBOX]                       â”‚ â”‚
â”‚  â”‚ FINALIZE            â†’ [STATUS, INBOX, THREADS_LIST]         â”‚ â”‚
â”‚  â”‚ USERS_ME_UPDATE_TZ  â†’ [ME] â˜…P1-3                            â”‚ â”‚
â”‚  â”‚ LIST_CREATE         â†’ [LISTS] â˜…P1-3                         â”‚ â”‚
â”‚  â”‚ LIST_ADD_MEMBER     â†’ [LISTS] â˜…P1-3                         â”‚ â”‚
â”‚  â”‚ CONTACT_CREATE      â†’ [CONTACTS] â˜…P1-4                      â”‚ â”‚
â”‚  â”‚ CONTACT_UPDATE      â†’ [CONTACTS] â˜…P1-4                      â”‚ â”‚
â”‚  â”‚ CONTACT_DELETE      â†’ [CONTACTS] â˜…P1-4                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Backend Routes è©³ç´°

| ãƒ•ã‚¡ã‚¤ãƒ« | ãƒã‚¤ãƒˆ | ä¸»è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ |
|---------|-------|------------------|
| `threads.ts` | 57,015 | /api/threads/* |
| `pendingActions.ts` | 24,739 | /api/pending-actions/* |
| `invite.ts` | 19,711 | /i/:token, /api/invites/* |
| `auth.ts` | 15,319 | /auth/* |
| `workItems.ts` | 13,114 | /api/work-items/* |
| `threadsFinalize.ts` | 12,998 | /api/threads/:id/finalize |
| `adminDashboard.ts` | 11,420 | /admin/* |
| `listItems.ts` | 11,322 | /api/list-items/* |
| `listMembers.ts` | 10,341 | /api/lists/:id/members/* |
| `lists.ts` | 10,090 | /api/lists/* |
| `businessCards.ts` | 9,733 | /api/business-cards/* |
| `threadsStatus.ts` | 9,726 | /api/threads/:id/status |
| `rooms.ts` | 8,009 | /api/rooms/* |
| `threadsRemind.ts` | 7,969 | /api/threads/:id/remind |
| `contacts.ts` | 7,699 | /api/contacts/* |
| `calendar.ts` | 7,605 | /api/calendar/* |
| `voice.ts` | 7,197 | /api/voice/* |
| `adminAi.ts` | 6,290 | /admin/ai/* |
| `inbox.ts` | 6,325 | /api/inbox/* |
| `usersMe.ts` | 3,907 | /api/users/me |
| `adminSystem.ts` | 3,684 | /admin/system/* |
| `otp.ts` | 3,929 | /api/otp/* |
| `testRateLimit.ts` | 1,253 | /test/rate-limit/* |
| `billing/index.ts` | - | /api/billing/* |
| `billing/me.ts` | - | /api/billing/me |
| `billing/myaspSync.ts` | - | /api/billing/myasp-sync |

---

## ğŸ“ Frontend Cache è©³ç´°

| ãƒ•ã‚¡ã‚¤ãƒ« | è¡Œæ•° | å¯¾è±¡API | TTL |
|---------|------|---------|-----|
| `meCache.ts` | 231 | /api/users/me | 60s |
| `listsCache.ts` | 236 | /api/lists | 60s |
| `contactsCache.ts` | 238 | /api/contacts | 60s â˜…P1-4 |
| `threadStatusCache.ts` | 303 | /api/threads/:id/status | 15s |
| `threadsListCache.ts` | 216 | /api/threads | 30s |
| `inboxCache.ts` | 216 | /api/inbox | 30s |
| `useThreadStatus.ts` | 197 | React hook | - |
| `index.ts` | 87 | exports | - |

---

## ğŸ“ Migrations è©³ç´°

### Phaseåˆ¥åˆ†é¡

| Phase | ç¯„å›² | ãƒ•ã‚¡ã‚¤ãƒ«æ•° |
|-------|------|----------|
| åŸºç›¤ | 0001-0010 | 9 |
| ç®¡ç†ãƒ»ã‚·ã‚¹ãƒ†ãƒ  | 0014-0018 | 5 |
| ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ | 0021-0031 | 10 |
| ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«èª¿æ•´ | 0032-0047 | 16 |
| èª²é‡‘ãƒ»ãƒªã‚¹ãƒˆ | 0048-0055 | 8 |
| ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ | 0060-0064 | 5 |
| Beta A / Phase 2 | 0065-0073 | 9 |

### é‡è¦ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

| ç•ªå· | åå‰ | é‡è¦åº¦ |
|------|------|-------|
| 0001 | init_core | â˜…â˜…â˜… åŸºç›¤ |
| 0026 | threads_and_invites | â˜…â˜…â˜… ã‚¹ãƒ¬ãƒƒãƒ‰ |
| 0034 | scheduling_slots | â˜…â˜…â˜… ã‚¹ãƒ­ãƒƒãƒˆ |
| 0065 | pending_actions | â˜…â˜… Beta A |
| 0066 | invite_deliveries | â˜…â˜… é…ä¿¡è¿½è·¡ |
| 0067-0069 | proposal_version | â˜…â˜… Phase 2 |
| 0072-0073 | timezone | â˜…â˜… TZå¯¾å¿œ |

---

## âœ… æ¤œè¨¼æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥å±¤ï¼ˆP1-3/P1-4å®Œäº†ï¼‰

- [x] `meCache.ts` - TTL 60s, inflightå…±æœ‰, subscribe/unsubscribeãƒ­ã‚°
- [x] `listsCache.ts` - TTL 60s, inflightå…±æœ‰, subscribe/unsubscribeãƒ­ã‚°
- [x] `contactsCache.ts` - TTL 60s, inflightå…±æœ‰, subscribe/unsubscribeãƒ­ã‚° â˜…P1-4
- [x] `index.ts` - meCache/listsCache/contactsCache exportsè¿½åŠ 
- [x] `runRefresh.ts` - ME/LISTS/CONTACTS refreshè¿½åŠ 
- [x] `refreshMap.ts` - USERS_ME_UPDATE_TZ, LIST_*, CONTACT_* è¿½åŠ 

### Executorå±¤ï¼ˆP1-1/P1-4å®Œäº†ï¼‰

- [x] `list.ts` - refreshLists() + refreshContacts() å‘¼ã³å‡ºã—ä¿®æ­£ â˜…P1-4
- [x] `thread.ts` - åˆ†å‰²æ¸ˆã¿
- [x] `calendar.ts` - åˆ†å‰²æ¸ˆã¿

### Hooksï¼ˆP1-3å®Œäº†ï¼‰

- [x] `useViewerTimezone.ts` - meCacheé€£æº

---

**ä½œæˆ**: 2026-01-17  
**æ›´æ–°**: å¿…è¦ã«å¿œã˜ã¦
