# BILLING_AND_LIMITS.md

**プラン別制限とEntitlements仕様**

---

## ドキュメント情報

| 項目 | 内容 |
|------|------|
| バージョン | v1.0 |
| 作成日 | 2026-01-01 |
| ステータス | ✅ 確定（変更は影響範囲必須） |
| 関連文書 | `PRODUCT_VISION_OS.md`, `RELATIONSHIP_POLICY.md` |

---

## 目的

- 制限の単位と超過時の挙動を固定し、実装で揉めないようにする
- 「提案はできるが実行は止める」を全プラン共通の安全原則にする

---

## 制御単位（固定）

- **User（オーナー）単位**：課金、BYO APIキー、顧客台帳（Contacts）、ルール（Policies）
- **Thread単位**：文脈・履歴・カード表示
- **Schedule単位**：状態（募集中/投票/確定/変更/キャンセル）、成立条件、参加者、実行ログ
- **Link単位**：入口（予約モード/投票モード）、有効期限、公開範囲

---

## 実行前チェック（必須ルール）

実行の直前に必ず **entitlement** をチェックする。

**超過時は：**
- ✅ 提案・表示はする
- ❌ 実行（作成/送信/確定/同期）は止める
- ✅ 代替案（手動/アップグレード/分割）を提示する

---

## Entitlements（制限項目）

### (A) Link関連
- Link作成数（月次）
- Linkの同時有効数
- Linkの参加者上限（1対N可否含む）

### (B) Schedule関連
- 同時進行Schedule数（募集中/投票中/変更依頼中の合計）
- 1対Nイベント数（月次 or 同時）
- 成立条件の高度機能（キーマン必須/N人以上）

### (C) 送信関連（チャネル別）
- 招待・通知の送信数（月次）
  - Email
  - Slack
  - Chatwork
- **「自動送信」は原則禁止**（Enterprise丸投げON以外）

### (D) Contacts（顧客台帳）
- Contacts登録数上限（人）
- 取込み（名刺/メール/Slack/Chatwork）の上限（任意：月次）

### (E) BYO API（OpenAI/Gemini）
- 全プランで利用可
- 会話・意図理解の回数は「運営側の制限対象ではない」（ユーザーキー負担のため）
- ただし **実行権限はプラン×距離感×同意で制御**（`docs/RELATIONSHIP_POLICY.md` 参照）

---

## プラン別上限（初期値：運用で調整可）

数値はプロダクト戦略で調整して良いが、**制御単位と超過時挙動は固定**。

### Free
- Link作成：5/月
- 同時進行Schedule：3
- 最大参加人数：2（1対1のみ）
- Contacts：30人
- 自動実行：不可（externalのみ）

### Pro
- Link作成：30/月
- 同時進行Schedule：5
- 最大参加人数：3
- Contacts：300人
- **work**：確認付き自動登録（Pro以上）
- **family**：確認なし自動登録（Pro以上）

### Team
- Link作成：無制限（運用でAPI/スパム制御）
- 同時進行Schedule：10
- 最大参加人数：5（初期）
- Contacts：3,000人
- **team**：共有カレンダー前提で自動確定・登録（Team以上）

### Enterprise
- 実質無制限（安全のためレート制御＋監査）
- **丸投げモード（明示ON）可能**
- **RAG（過去判断ログ参照）可能**

---

## 料金（確定）

- **Free**：¥0
- **Pro**：¥980/月
- **Team**：¥2,980/月
- **Enterprise**：¥15,000/月

---

## 計測（usage metrics：最低限これ）

以下を必ず計測する：
- Link作成数
- 同時進行Schedule数
- 1対Nイベント数
- 招待/通知送信数（チャネル別）
- 変更/キャンセル依頼数
- BYO API設定の有無（回数は参考値）

---

## 超過時のユーザー提示テンプレ（固定）

「**上限に達しています。提案は表示できますが、実行はできません。**」

**選択肢を提示：**
- 手動で実行する
- プランを上げる
- 数を減らす（完了させる）

---

**END OF DOCUMENT**
