# UX_CHAT_SPEC.md
## ToMoniWao – 最終UX（チャット秘書）仕様 "正（Source of Truth）"

最終更新: 2025-12-29  
目的: 以後のUI/UX議論・AI指示の前提を固定し、推測実装による事故を防ぐ

---

## 0. 絶対前提（変更禁止）
- 最終形は「チャット＝秘書との会話スペース」が主役。
- 左は "会話/案件（スレッド）" の一覧、右はチャット。
- いまのDashboard/Threads/Contacts/Listsは **審査・検証用の仮UI**（最終形ではない）。
- 日程調整のロジック・DB・マイグレーション・APIコントラクトは変更しない。

---

## 1. 画面の役割（最終形）
### 1.1 3チャンネルを固定する（ここが最重要）
- **Chat（主）**: 秘書との会話・結果報告・重要通知
- **Card（補助）**: 「確認・比較・選択・集計」が必要な時だけ
- **Bell（通知）**: external（他人）からの軽通知・重要度低いものを隔離（"うざい"回避）

> 原則: 「結果は文章」「選ぶ/比較する時だけカード」「外部の軽通知はベル」

---

## 2. スレッド（左カラム）の定義
### 2.1 スレッド = "秘書が管理している文脈（案件）"
- 家族旅行
- 仕事の打ち合わせ（Room/Grid）
- 他人との打ち合わせ（リンク調整）
- 募集イベント（参加率最大化）

### 2.2 最終形では "手でスレッドを作らない"
- 「田中さんに来週の打合せ送って」→ 秘書がスレッド生成
- テスト/検証UIでは手入力が残ってよい（ただし最終形の前提にしない）

### 2.3 左スレッド一覧に出すもの（固定）
- title
- status
- pending_count（未返信数）
- updated_at（最終更新）

---

## 3. 関係性でUXは分岐する（最重要）
### 3.1 relationship_type
- **family**: 自動確定・代理登録が許容される領域（結果だけ通知）
- **coworker**: Room/Grid前提。AIが空きを見て提案→合意で確定（経過はAIが吸収）
- **external**: TimeRex/Spear型。リンク送付→相手が選ぶ→主催者確定

### 3.2 相手がツール利用者かどうか
- 利用者: アプリ内（Chat/Bell）で通知
- 非利用者: メール＋/i/:token誘導

---

## 4. "カードにする/しない" の判断ルール（固定）
### 4.1 文章だけで良い（カード禁止）
- AIが裏で調整して「結果だけ返せる」ケース
  - 家族予定を入れた
  - coworkerで日時が確定した
  - リマインドを送った
  - 確定しました（要点）

### 4.2 カードが必要（許可）
- ユーザーが **選ぶ/比較する**
  - 候補日時の一覧・票数・未返信
- ユーザーが **状況を把握する**
  - 募集の進捗、参加者数、未返信者
- データを **一覧で見る**
  - リスト一覧、連絡先一覧、名刺情報

---

## 5. 例文10本（音声/テキスト共通・固定）
### Family
1) 「3週間後から1週間、家族旅行で予定全部ブロックして」
2) 「両親の予定も含めて旅行予定入れておいて」

### Coworker
3) 「A社RoomのAさんBさんと、来週どこか1時間で打合せ組んどいて」
4) 「明日の午後ならいつでもいい、決めといて」
5) 「この件、Aさんだけは必須で入れて」

### External
6) 「田中さんと佐藤さんに来週の午後で日程調整送って」
7) 「このリスト30人に勉強会の案内送って。締切2週間後」

### Status/Query
8) 「今募集してる予定って何がある？」
9) 「このイベント、今何人参加？未返信は？」
10) 「今日の予定教えて」

---

## 6. 現在のMVP（審査用）の位置づけ
- 現在は externalリンク型を中心に "動く証拠" を作る（審査動画用）。
- 「将来AIが最適化」は **将来機能として説明**し、現状実演範囲と混ぜない。
- 最終形チャットUXは、E2Eと審査が落ち着いてから段階的に実装する。

---

## 7. 現状（Phase 0B MVP）の実装状況

### 実装済み
- ✅ Dashboard のカード型 UI（Thread 一覧 → 詳細）
- ✅ Thread 作成フォーム（ThreadCreatePage）
- ✅ 招待リンク送付（external / メール通知）
- ✅ 外部招待者の日程選択 UI（/i/:token）
- ✅ 票数表示（各候補日時への選択数）
- ✅ 主催者による手動確定（ThreadDetailPage）
- ✅ Google Meet URL 生成（finalize 後）

### 未実装（Phase Next で対応予定）
- ❌ チャット UI（左スレッド一覧 / 右会話ログ）
- ❌ ベルアイコン UI（inbox テーブルは実装済み）
- ❌ 発話 → AI 判定 → API 呼び出し
- ❌ AND/CORE/MAX の自動判定
- ❌ AI 調整ループ（現状は主催者が手動確定）
- ❌ coworker / family の関係性対応

### 暫定 UI の位置づけ
現状の Dashboard / ThreadCreatePage / ThreadDetailPage は **審査用の検証 UI** であり、最終形ではない。

- **Phase Next-1**: チャット UI の器を実装（左スレッド一覧 / 右チャットログ）
- **Phase Next-2**: 発話 → intent → API 呼び出しを実装
- **Phase Next-3**: Google Calendar 読み取り + 権限管理を実装

👉 **現状は「外部リンク型の日程調整」を中心に動作確認を行う段階**

---
